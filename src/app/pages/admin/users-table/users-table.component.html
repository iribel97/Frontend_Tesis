<ui-toast #toast></ui-toast>
<div>
    <p class="text-xl font-semibold text-gray-800 dark:text-neutral-200">Administrador de usuarios</p>
</div>
<div>
    <p class="text-lg text-gray-600 dark:text-neutral-100">Administra usuarios existentes en el sistema</p>
</div>
<div class="container mx-auto mt-5">

    <div class="flex justify-between items-center">
        <!-- Botón para añadir usuario -->
        <button class="bg-blue-500 text-white px-4 py-2 mb-4 rounded flex items-center gap-2"
            (click)="openAddUserModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-user-plus">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0"></path>
                <path d="M16 19h6"></path>
                <path d="M19 16v6"></path>
                <path d="M6 21v-2a4 4 0 0 1 4 -4h4"></path>
            </svg>
            Crear
        </button>

        <!-- Input para buscar -->
        <div class="mb-4 w-full lg:w-4/5">
            <input type="text" [(ngModel)]="searchTerm" (input)="onSearchTermChange()"
                class="border-gray-300 border p-2 w-full rounded-lg"
                placeholder="Buscar por cédula, nombres, apellidos o correo...">
        </div>
    </div>

    <!-- Tabla de usuarios -->
    <table
        class="table-auto border-collapse border-t border-b border-gray-300 shadow-lg rounded-lg overflow-hidden w-full divide-y divide-gray-200">
        <thead class="bg-gray-100 text-gray-500">
            <tr>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Cédula</th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Nombres</th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Apellidos
                </th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Correo</th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Teléfono</th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Rol</th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Estado</th>
                <th class="border-t border-b border-gray-200 py-3 px-4 font-semibold text-lg">Acciones</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let user of paginatedUsers" class="hover:bg-gray-100 transition">
                <td class="px-6 py-4 font-medium text-gray-900">{{ user.cedula }}</td>
                <td class="px-6 py-4 font-medium text-gray-900">{{ user.nombres }}</td>
                <td class="px-6 py-4 font-medium text-gray-900">{{ user.apellidos }}</td>
                <td class="px-6 py-4 font-medium text-gray-900">{{ user.correo }}</td>
                <td class="px-6 py-4 font-medium text-gray-900">{{ user.telefono }}</td>
                <td class="px-6 py-4 font-medium text-gray-900">{{ user.rol }}</td>
                <td class="px-6 py-4 font-medium text-gray-900">
                    <ng-container *ngIf="editingUser === user.cedula; else viewMode">
                        <select [(ngModel)]="user.estado" class="border-gray-300 border p-2 rounded-lg">
                            <option value="Inactivo">Inactivo</option>
                            <option value="Suspendido">Suspendido</option>
                        </select>
                    </ng-container>
                    <ng-template #viewMode>
                        {{ user.estado }}
                    </ng-template>
                </td>
                <td class="px-6 py-4 font-medium text-gray-900">
                    <ng-container *ngIf="editingUser === user.cedula; else editMode">
                        <button class="bg-green-500 px-2 py-1 rounded text-white mr-2" (click)="saveUser(user)">
                            Guardar
                        </button>
                    </ng-container>
                    <ng-template #editMode>
                        <button class="bg-yellow-400 px-2 py-1 rounded text-white mr-2" (click)="editUser(user.cedula)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round"
                                class="icon icon-tabler icons-tabler-outline icon-tabler-user-edit">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M12 20h9" />
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3l-10 10l-4 1l1 -4l10 -10z" />
                                <path d="M13.5 6.5l4 4" />
                            </svg>
                        </button>
                    </ng-template>
                    <button class="bg-red-500 px-2 py-1 rounded text-white" (click)="deleteUser(user.cedula)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-tabler icons-tabler-outline icon-tabler-user-minus">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4c.348 0 .686 .045 1.009 .128" />
                            <path d="M16 19h6" />
                        </svg>
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Controles de paginación (sólo si hay más de 10 elementos filtrados) -->
    <div *ngIf="filteredUsers.length > itemsPerPage" class="flex justify-center mt-4">
        <button *ngFor="let page of [].constructor(totalPages); let i = index" (click)="changePage(i + 1)"
            [class.bg-gray-400]="currentPage === i + 1" class="px-3 py-1 mx-1 border rounded">
            {{ i + 1 }}
        </button>
    </div>
</div>

<!-- Modal para agregar usuario -->
<div *ngIf="showAddUserModal" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/2 z-50">
        <h2 class="text-lg font-semibold text-gray-900 mb-2">Agregar Usuario</h2>
        <form-register-user (userAdded)="onUserAdded($event)"></form-register-user>
        <div class="flex justify-end gap-2 mt-4">
            <button class="bg-gray-500 text-white px-4 py-2 rounded" (click)="closeAddUserModal()">Cancelar</button>
        </div>
    </div>
    <div class="fixed inset-0 bg-black opacity-50 z-40"></div>
</div>
<ui-modal modalId="DeleteUser" [isOpen]="false">
    <h2 class="text-lg font-semibold text-gray-900 mb-2">
        Confirmación de eliminación de usuario
    </h2>
    <p class="text-gray-800 mb-4">
        ¿Está seguro que desea eliminar al usuario? Esta acción no se puede deshacer.
    </p>
    <div class="flex justify-end gap-2">
        <button class="bg-gray-500 text-white px-4 py-2 rounded" (click)="closeModal('DeleteUser')">Cancelar</button>
        <button class="bg-red-500 text-white px-4 py-2 rounded" (click)="confirmDeleteUser()">Eliminar</button>
    </div>
</ui-modal>