@if (materia?.unidades && materia.unidades.length > 0) {
    <!-- Acordeón principal: Unidades -->
    @for (unidad of materia?.unidades; track unidad.idUnidad) {
        <div class="border border-gray-300 rounded-md mb-4">
            <!-- Botón del acordeón (Unidad) -->
            <div class="flex items-center justify-between px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring transition duration-300">
                <!-- Modo Visual -->
                <div *ngIf="!unidad.editando; else editandoUnidad" class="flex items-center justify-between w-full">
                    <!-- Título de la unidad a la izquierda -->
                    <span class="text-gray-900 font-semibold text-left">
            {{ unidad.nombre }}
        </span>

                    <!-- Botón de edición a la derecha -->
                    <button (click)="activarEdicionUnidad(unidad)"
                            class="text-blue-500 hover:text-blue-600 focus:outline-none">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                             class="icon icon-tabler icons-tabler-outline icon-tabler-edit">
                            <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                            <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"/>
                            <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"/>
                            <path d="M16 5l3 3"/>
                        </svg>
                    </button>
                </div>

                <!-- Modo de Edición -->
                <ng-template #editandoUnidad>
                    <div class="flex items-center justify-between w-full">
                        <!-- Campo de texto para editar el nombre de la unidad -->
                        <input [(ngModel)]="unidad.editandoNombre"
                               type="text"
                               class="border text-sm border-gray-300 px-2 py-1 rounded-md w-full mr-2"
                               placeholder="Editar nombre de la unidad">

                        <!-- Botón para guardar los cambios -->
                        <button (click)="guardarCambiosUnidad(unidad)"
                                class="text-green-500 hover:text-green-600 focus:outline-none p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round"
                                 class="icon icon-tabler icons-tabler-outline icon-tabler-check">
                                <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                                <path d="M5 12l5 5l10 -10"/>
                            </svg>
                        </button>

                        <!-- Botón para cancelar los cambios -->
                        <button (click)="cancelarEdicionUnidad(unidad)"
                                class="text-red-500 hover:text-red-600 focus:outline-none p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x">
                                <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                                <path d="M18 6l-12 12"/>
                                <path d="M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </ng-template>
            </div>


            @if (unidad.contenido.length > 0) {
                <!-- Contenido oculto/visible (Unidad) -->
                <div [hidden]="!unidad.open" class="px-4 pt-2 pb-4 bg-gray-50">
                    <!-- Acordeón secundario: Temas -->
                    @for (tema of unidad.contenido; track tema.idTema) {
                        <div class="border border-gray-200 rounded-md mb-2">
                            <!-- Botón del acordeón (Tema) -->
                            <button (click)="toggleTema(tema)"
                                    class="w-full text-left px-4 py-2 text-gray-800 font-medium bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring transition duration-300">
                                {{ tema.nombreTema }} - <small>{{ tema.descripcion }}</small>

                                <!-- Botón de editar Tema -->
                                <button class="ml-2 px-2 py-1 bg-green-500 text-white rounded-md text-sm hover:bg-green-600">
                                    Editar
                                </button>

                                <!-- Botón para mostrar si el tema es visible para los estudiantes (solo para docentes) -->
                                <button *ngIf="rolUser === 'Docente'"
                                        class="ml-2 text-sm text-blue-500 hover:underline">
                                    {{ tema.activo ? 'Visible para estudiantes' : 'No visible para estudiantes' }}
                                </button>
                            </button>

                            <!-- Contenido oculto/visible (Tema) -->
                            <div [hidden]="!tema.open" class="px-4 py-2 bg-white border-t border-gray-200">
                                <!-- Materiales -->
                                <h4 class="text-2xl font-semibold text-gray-700 mb-1">Materiales</h4>
                                @if (tema.materiales.length === 0) {
                                    <p class="text-gray-700">No hay materiales registrados para este tema.</p>
                                } @else {
                                    <ul class="list-disc list-inside mb-2">
                                        @for (material of tema.materiales; track material.idMaterial) {
                                            <li class="flex items-center justify-between">
                                                <!-- Material con enlace -->
                                                @if (material.link) {
                                                    <div class="flex flex-row items-center w-full">
                                                        <a [href]="material.link"
                                                           class="border flex flex-row mb-2 w-full text-left px-4 py-3 text-gray-900 font-semibold bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring transition duration-300"
                                                           target="_blank" rel="noopener noreferrer">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                 height="24"
                                                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                                 stroke-width="2"
                                                                 stroke-linecap="round" stroke-linejoin="round"
                                                                 class="icon icon-tabler icons-tabler-outline icon-tabler-link mr-2">
                                                                <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                                                                <path d="M9 15l6 -6"/>
                                                                <path d="M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464"/>
                                                                <path
                                                                        d="M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463"/>
                                                            </svg>
                                                            {{ material.nombreLink }}
                                                        </a>
                                                        <!-- Botón de editar material con enlace -->
                                                        <button class="ml-2 px-2 py-1 bg-purple-500 text-white rounded-md text-sm hover:bg-purple-600">
                                                            Editar
                                                        </button>
                                                    </div>
                                                } @else {
                                                    <!-- Material con archivo -->
                                                    <div class="border flex flex-row mb-3 w-full text-left px-4 py-3 text-gray-900 font-semibold bg-gray-100 hover:bg-gray-200 rounded-md focus:outline-none focus:ring transition duration-300">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                             height="24"
                                                             viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                             stroke-width="2"
                                                             stroke-linecap="round" stroke-linejoin="round"
                                                             class="icon icon-tabler icons-tabler-outline icon-tabler-file mr-2">
                                                            <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                                                            <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                                            <path
                                                                    d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                                        </svg>
                                                        <a (click)="utilityService.descargarDocumento(material.documento.base64, material.documento.nombre, material.documento.mime)"
                                                           class="cursor-pointer">
                                                            {{ material.documento.nombre }}
                                                        </a>
                                                        <!-- Botón de editar material con archivo -->
                                                        <button class="ml-2 px-2 py-1 bg-purple-500 text-white rounded-md text-sm hover:bg-purple-600">
                                                            Editar
                                                        </button>
                                                    </div>
                                                }
                                            </li>
                                        }
                                    </ul>
                                }
                            </div>
                        </div>
                    }
                </div>
            } @else {
                <div [hidden]="!unidad.open" class="px-4 pt-2 pb-4 bg-gray-50">
                    <p class="text-gray-700">No hay contenido registrados para este tema.</p>
                </div>
            }
        </div>
    }
}

<div class="flex flex-row justify-start"><!-- Input para escribir el nombre de la unidad -->
    @if (mostrarInput) {
        <div class="flex flex-row items-center w-full transition-all duration-300 ease-in-out transform scale-100 opacity-100">
            <input type="text"
                   [(ngModel)]="tituloUnidad"
                   (keyup.enter)="guardarUnidad()"
                   class="border border-gray-300 px-4 py-2 rounded-md w-full mr-2"
                   placeholder="Escribe el título de la Unidad y presiona Enter">
            <button
                    class="ml-2 text-red-500 hover:text-red-600"
                    (click)="ocultarInputUnidad()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="icon icon-tabler icons-tabler-outline icon-tabler-x">
                    <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                    <path d="M18 6l-12 12"/>
                    <path d="M6 6l12 12"/>
                </svg>
            </button>
            <button
                    class="ml-2 text-green-500 hover:text-green-600"
                    (click)="guardarUnidad()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="icon icon-tabler icons-tabler-outline icon-tabler-check">
                    <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                    <path d="M5 12l5 5l10 -10"/>
                </svg>
            </button>
        </div>
    }

    @if (!mostrarInput) {
        <!-- Botón Crear Unidad -->
        <button (click)="mostrarInputUnidad()"
                class="px-4 py-2 bg-gray-100 rounded-md text-lg w-full flex items-center justify-center hover:shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                 class="icon icon-tabler icons-tabler-outline icon-tabler-plus mr-2">
                <path stroke="none" d="M0 0h24V0H0z" fill="none"/>
                <path d="M12 5l0 14"/>
                <path d="M5 12l14 0"/>
            </svg>
            Crear Unidad
        </button>
    }
</div>
